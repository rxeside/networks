# Документ по проектированию: Итеративный DNS-резолвер

## 1. Краткое описание архитектуры и алгоритма

Данный DNS-резолвер является консольным приложением на C++, реализующим **итеративный** алгоритм разрешения доменных имен. В отличие от рекурсивного запроса (когда клиент просит сервер сделать всю работу), итеративный резолвер самостоятельно выполняет всю цепочку запросов.

### Алгоритм работы:

1.  **Инициализация**: Процесс начинается с жестко закодированного IP-адреса одного из корневых DNS-серверов (`root server`).
2.  **Формирование запроса**: Программа создает DNS-запрос в бинарном формате согласно RFC 1035. В запросе указывается искомое доменное имя и тип записи (A для IPv4, AAAA для IPv6). Флаг рекурсии (RD) в заголовке запроса **отключен**, что является ключевой особенностью итеративного процесса.
3.  **Итеративный цикл**:
    *   Программа отправляет UDP-пакет с DNS-запросом на текущий сервер имен (на первой итерации — на корневой сервер).
    *   Получив ответ, программа анализирует его секции:
        *   **Секция ответов (`Answer Section`)**: Если в этой секции содержится искомая запись (например, A-запись с IP-адресом), то процесс разрешения считается успешным, результат выводится на экран, и программа завершается.
        *   **Секция авторитетных серверов (`Authority Section`)**: Если ответов нет, эта секция содержит имена серверов, ответственных за следующую зону (например, для `google.com` корневой сервер вернет NS-записи для зоны `.com`).
        *   **Секция дополнительных записей (`Additional Section`)**: Эта секция обычно содержит IP-адреса (`glue records`) для серверов имен, перечисленных в `Authority Section`. Это позволяет избежать лишнего шага по разрешению имени самого NS-сервера.
    *   Программа извлекает IP-адрес NS-сервера из дополнительной секции и использует его в качестве нового `dns_server_ip` для следующей итерации.
4.  **Завершение**: Цикл повторяется, каждый раз "спускаясь" на один уровень ниже в иерархии DNS (root -> TLD -> authoritative server), пока не будет найден конечный IP-адрес или пока не будет достигнут лимит итераций.

Программа также поддерживает опциональный режим отладки (`-d`), который выводит подробную информацию о каждой итерации, включая адрес опрашиваемого сервера и состав полученного ответа.

## 2. Инструкция по сборке и запуску

### Сборка в CLion

1.  Откройте проект `dns_resolver` в CLion.
2.  CLion автоматически настроит `CMakeLists.txt`.
3.  Для сборки проекта нажмите на иконку молотка (Build) или используйте сочетание клавиш `Ctrl+F9`. Исполняемый файл `dns_resolver` будет создан в директории `cmake-build-debug`.

### Запуск из командной строки

Для запуска откройте терминал в директории `cmake-build-debug`.

**Синтаксис:**
`./dns_resolver <доменное_имя> <тип_записи> [-d]`

**Примеры использования:**

1.  **Обычный режим (получение IPv4-адреса):**
    ```bash
    ./dns_resolver google.com A
    ```
    *Ожидаемый вывод:*
    ```
    google.com -> 142.250.185.78
    ```

2.  **Обычный режим (получение IPv6-адреса):**
    ```bash
    ./dns_resolver google.com AAAA
    ```
    *Ожидаемый вывод:*
    ```
    google.com -> 2a00:1450:4001:82e::200e
    ```

3.  **Режим отладки:**
    ```bash
    ./dns_resolver yandex.ru A -d
    ```
    *Ожидаемый вывод (фрагмент):*
    ```
    Starting resolution for yandex.ru (type 1)

    --- Iteration 1 ---
    Querying server: 198.41.0.4
    Response received. Questions: 1 Answers: 0 Authority: 13 Additional: 13
    Found next server to query: a.dns.ripn.net at 193.232.128.6

    --- Iteration 2 ---
    Querying server: 193.232.128.6
    Response received. Questions: 1 Answers: 0 Authority: 2 Additional: 2
    Found next server to query: ns1.yandex.net at 213.180.193.1

    --- Iteration 3 ---
    Querying server: 213.180.193.1
    Response received. Questions: 1 Answers: 1 Authority: 2 Additional: 0
    yandex.ru -> 77.88.55.77
    ```