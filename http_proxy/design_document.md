# Документ по проектированию: Кэширующий HTTP Прокси-сервер

## 1. Описание алгоритма работы

Данный проект реализует простой однопоточный итеративный HTTP прокси-сервер. Он способен принимать HTTP GET-запросы от одного клиента (например, браузера), перенаправлять их на целевой веб-сервер, а полученный ответ кэшировать на диске для ускорения последующих запросов к тому же ресурсу.

### Основной цикл работы:
1.  **Ожидание соединения**: Сервер слушает указанный порт и блокируется на системном вызове `accept()`, ожидая подключения клиента.
2.  **Прием запроса**: После установки соединения, сервер читает HTTP-запрос от клиента.
3.  **Парсинг**: Из запроса извлекается метод (поддерживается только `GET`) и полный URL запрашиваемого ресурса.
4.  **Проверка кэша**: Сервер обращается к алгоритму кэширования для проверки, был ли данный URL запрошен ранее.
5.  **Обработка "Cache Hit" (Попадание в кэш)**:
    *   Если в локальном кэше найден соответствующий файл, его содержимое читается и напрямую отправляется клиенту.
    *   Соединение с клиентом закрывается. Запрос к целевому веб-серверу не выполняется, что экономит время и трафик.
6.  **Обработка "Cache Miss" (Промах кэша)**:
    *   Если ресурс в кэше отсутствует, прокси-сервер действует как клиент.
    *   Из URL извлекается имя хоста (например, `www.example.com`) и путь к ресурсу (`/page.html`).
    *   Происходит разрешение имени хоста в IP-адрес.
    *   Устанавливается новое TCP-соединение с целевым сервером на 80-й порт.
    *   Формируется и отправляется новый, упрощенный HTTP-запрос (например, `GET /page.html HTTP/1.0`).
    *   Сервер входит в цикл, в котором он читает ответ от целевого сервера порциями и одновременно выполняет два действия:
        1.  Отправляет полученные данные исходному клиенту.
        2.  Записывает эти же данные в новый файл в директории кэша.
    *   После получения полного ответа, все сокеты (с клиентом и с целевым сервером) и файл кэша закрываются.

## 2. Алгоритм кэширования

Кэширование реализовано на уровне файловой системы для простоты и наглядности.

*   **Директория кэша**: Все кэшированные объекты хранятся в поддиректории `cache/`, которая создается автоматически при первом запуске сервера.
*   **Ключ кэширования**: В качестве уникального ключа для каждого ресурса используется его полный URL.
*   **Имя файла**: Поскольку URL содержит символы, недопустимые в именах файлов (`/`, `:`, `?`), для сохранения объекта в кэш его URL преобразуется в безопасное имя файла. Это достигается путем замены всех недопустимых символов на подчеркивание (`_`).
    *   **Пример:** URL `http://example.com/images/logo.png` будет сохранен как файл `http___example.com_images_logo.png` в директории `cache/`.
*   **Проверка наличия в кэше**: "Попадание" или "промах" определяется простой проверкой существования файла с таким преобразованным именем.

Данная реализация не включает механизмы инвалидации кэша (проверки свежести данных), что является задачей для продвинутого уровня.

## 3. Инструкция по сборке и запуску

### Сборка
Проект собирается с помощью `CMake` в CLion. Стандартный `CMakeLists.txt` создаст исполняемый файл `http_proxy`.

### Запуск
1.  Перейдите в директорию сборки (`cmake-build-debug`).
2.  Запустите сервер, указав порт для прослушивания (например, 8888):
    ```bash
    ./http_proxy 8888
    ```
    Сервер выведет сообщение, что он готов к работе.

## 4. Тестирование с помощью браузера

### Настройка браузера
Самый простой способ — настроить Firefox:
1.  Откройте **Настройки**.
2.  В строке поиска введите "прокси" и выберите "Настроить...".
3.  Выберите опцию **"Ручная настройка прокси"**.
4.  В поле **"Прокси HTTP"** введите `localhost` (или `127.0.0.1`).
5.  В поле **"Порт"** введите тот же порт, на котором вы запустили сервер (например, `8888`).
6.  Поставьте галочку "Также использовать этот прокси для HTTPS" (хотя наш прокси не будет обрабатывать HTTPS, это поможет избежать проблем с современными сайтами).
7.  Нажмите **"OK"**.

### Процесс тестирования
1.  **Первый запрос (Cache Miss)**:
    *   В адресной строке браузера введите адрес какого-нибудь простого HTTP-сайта, например: `http://info.cern.ch` (первый веб-сайт в мире).
    *   Посмотрите в консоль, где запущен ваш прокси-сервер. Вы должны увидеть лог о принятом запросе и сообщение **`[INFO] Cache MISS`**. Страница в браузере загрузится.
2.  **Второй запрос (Cache Hit)**:
    *   **Полностью перезагрузите** ту же страницу в браузере (можно нажать `Ctrl+R` или `F5`).
    *   Снова посмотрите в консоль прокси. На этот раз вы увидите сообщение **`[INFO] Cache HIT`**.
    *   Обратите внимание, что страница загрузилась заметно быстрее.

3.  **Завершение:** Не забудьте вернуть настройки прокси в браузере в исходное состояние ("Без прокси" или "Использовать системные настройки прокси"), чтобы восстановить нормальную работу интернета.